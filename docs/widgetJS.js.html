<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>JSSSE Documentation Source: widgetJS.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.yeti.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">JSSSE Documentation</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-SasMol-SasMol.html">SasMol~SasMol</a></li><li><a href="module-JSSSE-bobj.html">JSSSE~bobj</a></li><li><a href="module-JSSSE-sobj.html">JSSSE~sobj</a></li><li><a href="module-JSSSE-jssse.html">JSSSE~jssse</a></li><li><a href="-_anonymous_-populateWindows-sasmolInfoObj.html"><anonymous>~populateWindows~sasmolInfoObj</a></li><li><a href="-_anonymous_-initialize-seqObj.html"><anonymous>~initialize~seqObj</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-SasMol.html">SasMol</a></li><li><a href="module-JSSSE.html">JSSSE</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#newBobj">newBobj</a></li><li><a href="global.html#testSobj">testSobj</a></li><li><a href="global.html#readFilefile">readFile(file)</a></li><li><a href="global.html#readmultifiles">readmultifiles</a></li><li><a href="global.html#handleRead">handleRead</a></li><li><a href="global.html#populateWindows">populateWindows</a></li><li><a href="global.html#populateSasMolInfo">populateSasMolInfo</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#createDivider">createDivider</a></li><li><a href="global.html#mirror">mirror</a></li><li><a href="global.html#updateCurrSelection">updateCurrSelection</a></li><li><a href="global.html#updateSelDisplay">updateSelDisplay</a></li><li><a href="global.html#clearAllSelection">clearAllSelection</a></li><li><a href="global.html#calibrateDisp">calibrateDisp</a></li><li><a href="global.html#getKeyByValue">getKeyByValue</a></li><li><a href="global.html#getObjectByValue">getObjectByValue</a></li><li><a href="global.html#displayLocator">displayLocator</a></li><li><a href="global.html#getIndexByWidth">getIndexByWidth</a></li><li><a href="global.html#populateZoomDiv">populateZoomDiv</a></li><li><a href="global.html#getPosition">getPosition</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: widgetJS.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">//running jsdoc command in terminal:
// jsdoc -c ./conf.json -d ../docs -R ../README.md -t ./node_modules/ink-docstrap/template
/**
 * @fileoverview Manages html display of widget and corresponding functionalities
 * @requires  JSSSE
 * @requires SasMol
 */
//bring in definitions (SASMOL and JSSSE)
//Sasmol is exported like so: {SasMol}; therefore, use SasMol (this file's variable) .SasMol (to access the actual SasMol class object)
var SasMol = require('./SASMOL\ JS/sasmol.js');
//likewise, use JSSSE.jssse.[jssse-defined methods] to correctly access the JSSSE methods
//same applies for JSSSE.bobj.[bobj methods] or JSSSE.sobj.[sobj methods]
var JSSSE = require('./jssse');

//disable right-click on page
window.addEventListener('contextmenu', function (e) { // Not compatible with IE &lt; 9
    e.preventDefault();
}, false);




//shorthand for $(document).ready(function(){ //CODE})
$( function() {

  /**************************************************************************
  __  __   __   __  _  _
 (  \/  ) (  ) (  )( \( )
  )    (  /__\  )(  )  (
 (_/\/\_)(_)(_)(__)(_)\_)

    *************************************************************************/

    var readBool = false; //flags
    var numPDB = 0; //global var for number of PDB's (read)
    var loadBool = false; //(debugging purposes - may be important in the future)
    var numAtomsArr = []; //global array for storing how many atoms per pdb (access with sobjIndex)


//TESTING - create JSSSE/bobj/sobjs at pleasure

    var jssseArr = [];  //stores sobjs
    /**
     * bobj object
     * @name newBobj
     * @type {module:JSSSE~bobj}
     *
     */
    var newBobj = JSSSE.jssse.createBoard( 'board0', {});
    /**
     * sobj object
     * @name testSobj
     * @type {module:JSSSE~sobj}
     *
     */
    var testSobj = JSSSE.jssse.createSobj( newBobj, 'sobj0');
    //DEMO
    // console.log(bobj);
    // console.log(testSobj);
    jssseArr[0] = testSobj;


/**
 * use Promises to wait until async operation is finished (initialize + populate windows correctly)
   src: https://stackoverflow.com/questions/41906697/how-to-determine-that-all-the-files-have-been-read-and-resolve-a-promise/
 * @name readFile(file)
 * @func
 * @param  {File} file file object
 */
function readFile(file) {
    return new Promise(function(resolve, reject) {
        var reader = new FileReader();
        reader.onload = function(e) {
            resolve(e.target.result);
        };
        reader.onerror = reader.onabort = reject;
        reader.readAsText(file);
    });
}

/**
 * use promises to wait until async operation is finished, calls helper method readFile
 * @name readmultifiles
 * @func
 * @param  {File[]} files array of file objects (different than FileList object)
 * @return {string[]}     array of files read (in literal text)
 */
function readmultifiles(files) {
    var results = [];
    files.reduce(function(p, file) {
        return p.then(function() {
            return readFile(file).then(function(data) {
                // put this result into the results array
                results.push(data);
            });
        });
    }, Promise.resolve()).then(function() {
        // make final resolved value be the results array
        // DEMO
        //console.log(results);

        //populate JSSSE objects and canvas windows
        readBool = true;
        numPDB = results.length;
        var info = "";
        for(var i = 0; i&lt;numPDB;i++){
          //info contains literal text from file
          info = results[i];
          /**
           * sasmol object
           * @type {module:SasMol~SasMol}
           *
           */
          jssseArr[i].sasmol = Object.create(SasMol.SasMol);
          //store read information inside jssse objects
          jssseArr[i].sasmol.readPDB(info);

          numAtomsArr[i] = jssseArr[i].sasmol.getAtom().length;

        }
        //DEMO
        console.log(jssseArr);
        for(var i = 0; i&lt;numPDB;i++){
          populateWindows(jssseArr[i].id, jssseArr[i].sasmol);
          initialize('start', jssseArr[i].sasmol,i);
        }
        return results;
    });
}
/**
 * main function triggered by event - calls multifiles to parse files
 * @name handleRead
 * @func
 * @param  {event} e event object - use to extract files
 */
function handleRead(e){
  var files = e.target.files;
  var fileArr = [];
  //convert fileList to array of files
  for(var i = 0,f;f=files[i];i++){
    fileArr[i]=f;
  }
  readmultifiles(fileArr);

}
//listen to when user inputs file(s) (event is triggered once user inputs file(s))
document.getElementById('files').addEventListener('change', handleRead, false);




    /*
 ____  ____  _  _  ____  __     __  ____  ____  ____     ___  __  ____  ____
(    \(  __)/ )( \(  __)(  )   /  \(  _ \(  __)(  _ \   / __)/  \(    \(  __)
 ) D ( ) _) \ \/ / ) _) / (_/\(  O )) __/ ) _)  )   /  ( (__(  O )) D ( ) _)
(____/(____) \__/ (____)\____/ \__/(__)  (____)(__\_)   \___)\__/(____/(____)
    */
// GLOBAL VARIABLES FOR keeping track of HTML within (potentially) multiple SOBJ's

   //access DOM elt's by classname (not id because they are not unique - multiple selects)
   var widgetContainerArr = [];
   var seqContainerArr = [];
   var seqDivArr = [];
   var locatorDivArr = [];
   var locatorBoxArr = [];
   var seqDivWidthArr = [];
   var zoomDivArr = [];
   // var seqSelDivArr = []; //for future reference?
   var seqSelRangeDivArr = [];

   var eltWidthArr = [];

   var dsArr = [];
   var zoomdsArr = [];
   var seqObjArr = [];        //Master array for all sequence objects
   var currentZoomedWidget;
  // var aminoAcidArr = [
  //   'ala', 'arg', 'asn', 'asp', 'cys', 'gln', 'glu', 'gly', 'his','ile','leu','lys', 'met', 'phe', 'pro', 'ser', 'thr','trp', 'tyr', 'val'
  // ];

  var eltWidth;
  var zoomPress = false;  //flag for pressing zoom
  var seqDivFlag = false; //flag for entering sequence Div (toggles on marker and locatorDiv)



//CREATE SEQUENCE OBJECT
//makes sobj's jquery-sortable (replacable when dragged over each other)
      $(".board")
      .sortable({
        items: ".sortable",
        placeholder: 'SSE placeholder',
        forceHelperSize: true,
        tolerance:'pointer',
        handle: '.handle',
        scroll: false,
        cursor: 'move'
      });
    var closeButtons = document.getElementsByClassName('close');
    //ADD EVENT LISTENERS TO DO THINGS WITH CLOSE BUTTON

/**
 * Populates windows attached to sobj's (all HTML necessary for sequence divs, feedback box, zoom div)
 * @name populateWindows
 * @function
 * @param  {String} sobjID [dom ID of sobj]
 * @param {sasmol}  object sasmol object
 */
  function populateWindows(sobjID, object){
    //console.log(sobjID);
    var sobjContent = document.getElementById(sobjID+' content');
    //create div elt's
    for(var i = 0; i &lt; numPDB; i++){
      var sobjIndex = i;
      //main sequence display
      var widgetContainer = document.createElement('div');
      //widgetContainer.style.textAlign = 'center';
      widgetContainer.classList.add('widget-container');
      widgetContainer.id = 'widget-container'+sobjIndex;
      //widgetContainer.style.position = 'absolute';

      var sequenceContainer = document.createElement('div');
      sequenceContainer.classList.add('sequenceContainer');
      //sequenceContainer.style.position = 'relative';
      var sequenceDiv = document.createElement('div');
      sequenceDiv.classList.add('sequenceDiv');
      sequenceDiv.id = 'sequenceDiv'+sobjIndex;
      sequenceDiv.tabIndex = '0';

      var sequenceDivHeader = document.createElement('p');
      sequenceDivHeader.style.margin = '5px';
      sequenceDivHeader.style.fontSize = '12px';
      var headerText = document.createTextNode('SEQUENCE SELECTION BOX:');
      sequenceDivHeader.appendChild(headerText);

      var marker = document.createElement('div');
      marker.classList.add('marker');
      var customSelector = document.createElement('div');
      customSelector.classList.add('customSelector');
      customSelector.style.height=  '100%';
      var locatorDiv = document.createElement('div');
      locatorDiv.classList.add('locatorDiv');
      var locatorBox = document.createElement('div');
      locatorBox.classList.add('locatorBox');
      var zoomDiv = document.createElement('div');
      zoomDiv.classList.add('zoomDiv');
      locatorDiv.appendChild(locatorBox);
      sequenceDiv.appendChild(marker);
      sequenceDiv.appendChild(customSelector);
      sequenceDiv.appendChild(locatorDiv);
      // sequenceDiv.appendChild(customSelector);

      sequenceContainer.appendChild(sequenceDiv);
      sequenceContainer.appendChild(zoomDiv);

      var sequenceSelInfoDiv = document.createElement('div');
      sequenceSelInfoDiv.classList.add('sequenceSelInfoDiv');
      sequenceSelInfoDiv.style.display = 'inline-block';
      sequenceSelInfoDiv.style.textAlign = 'center';
      var div = document.createElement('div');
      var title = document.createElement('strong');
      var titleText = document.createTextNode('CURRENT SELECTION');
      title.appendChild(titleText);
      var div2 = document.createElement('div');
      div2.style.textAlign = 'center';
      var clearSelBtn = document.createElement('button');
      clearSelBtn.classList.add('clearSelection');
      var clearSelBtnText = document.createTextNode('Clear Selection');
      var startSpan = document.createElement('span');
      var startText = document.createTextNode('START ');
      var startIndex = document.createElement('span');
      startIndex.classList.add('startIndex');
      var endSpan = document.createElement('span');
      var endText = document.createTextNode(' : END ');
      var endIndex = document.createElement('span');
      endIndex.classList.add('endIndex');

      var selectDisplay = document.createElement('div');
      selectDisplay.classList.add('selectDisplay');

      var selectDisplayRange = document.createElement('div');
      selectDisplayRange.classList.add('selectDisplayRange');

      selectDisplay.appendChild(selectDisplayRange);
      sequenceSelInfoDiv.appendChild(div);

      clearSelBtn.appendChild(clearSelBtnText);
      div2.appendChild(clearSelBtn);
      div.appendChild(title);
      div.appendChild(div2);
      startSpan.appendChild(startText);
      div.appendChild(startSpan);
      div.appendChild(startIndex);
      endSpan.appendChild(endText);
      div.appendChild(endSpan);
      div.appendChild(endIndex);
      div.appendChild(selectDisplay);


      widgetContainer.appendChild(sequenceSelInfoDiv);
      widgetContainer.appendChild(sequenceDivHeader);
      widgetContainer.appendChild(sequenceContainer);
      //append to sobj (top-level HTML elt)
      sobjContent.appendChild(widgetContainer);

      //EVENT LISTENERS
      //add clear selection functionality
      clearSelBtn.addEventListener('click',function(e){
        clearAllSelection(sobjIndex);
      });
      //add marker to follow mouse in div
      sequenceDiv.addEventListener('mousemove', function(e){
        seqDivFlag = true;
        var seqDivPosition = getPosition(sequenceDiv);
        //debugging
        //console.log('mousein '+ (e.pageX - seqDivPosition.x));
        marker.style.display = 'block';
        marker.style.left = (e.pageX - seqDivPosition.x)+'px';
        locatorBox.style.display = 'inline-block';

        //only display locator if there's a valid PDB being read
        if(readBool){
          //refer to helper function to geometrically get sequence index
          displayLocator(getIndexByWidth(e.pageX - seqDivPosition.x, sobjIndex), sobjIndex);
        }

      });

      sequenceDiv.addEventListener('mouseleave',function(e){
        seqDivFlag = false;
        //console.log('mouseout '+e.clientX);
        marker.style.display = 'none';
        locatorDiv.style.display = 'none';
      });
      //listen to right-click
      sequenceDiv.addEventListener('contextmenu',function(e){
        sequenceDiv.focus();
      });

      //what to do when update is clicked - make copy of current selection into a jQuery-droppable object
      document.getElementsByClassName('btn update')[0].addEventListener('click', function(e){
        //clear seqPieces first
        $('#seqPiece'+sobjIndex).remove();
        $('#drop'+sobjIndex).remove();

        //DEMO
        // console.log(JSON.stringify(arrDisp));
        var seqPiece = document.createElement('div');
        seqPiece.classList.add('seqPiece');
        seqPiece.id = 'seqPiece'+sobjIndex;
        var text = document.createTextNode(JSON.stringify(arrDisp));
        seqPiece.appendChild(text);
        sobjContent.appendChild(seqPiece);

        var dropDiv = document.createElement('div');
        dropDiv.classList.add('drop');
        dropDiv.id = 'drop'+sobjIndex;

        document.getElementById('builder-canvas').appendChild(dropDiv);
        $('.drop').droppable({
            tolerance: 'intersect',
            drop: function(event, ui) {
                var drop_p = $(this).offset();
                var drag_p = ui.draggable.offset();
                var left_end = drop_p.left - drag_p.left + 1;
                var top_end = drop_p.top - drag_p.top + 1;
                ui.draggable.animate({
                    top: '+=' + top_end,
                    left: '+=' + left_end
                });
            }
        });
        $('#seqPiece'+sobjIndex).draggable({
            revert: 'invalid',
            scroll: false,
            stack: ".seqPiece"
        });
      });

      //MAKE MODULAR + ADD MORE ELEMENTS
      var sasmolInfoDiv = document.createElement('div');
      sasmolInfoDiv.style.position = 'absolute';
      sasmolInfoDiv.style.top = '430px';  //MAKE RESPONSIVE/DYNAMIC
      /**
       * populates Sasmol info div - refer to object definition below to know what to pass as parameter
       * also handles display toggling (via checkbox eventlistener)
       * @name populateSasMolInfo
       * @func
       * @param  {sasmolInfo} param sasmol info object (definied below)
       */
      function populateSasMolInfo(param){
        var propDiv = document.createElement('div');
        var propInfo = document.createElement('div');
        var propCheckBox = document.createElement('input');
        var propTitle = document.createTextNode(param.title + ': ');
        var propText = document.createTextNode(param.info);
        propDiv.style.textAlign = 'left';
        propInfo.appendChild(propText);
        propInfo.style.display = 'none'
        propCheckBox.type = 'checkbox';
        propCheckBox.id = 'propCheckBox'+sobjIndex;
        propDiv.appendChild(propCheckBox);
        propDiv.appendChild(propTitle);
        propDiv.appendChild(propInfo);

        sasmolInfoDiv.appendChild(propDiv);
        sobjContent.appendChild(sasmolInfoDiv);
        //toggles display on or off based on if the checkbox is ticked
        propCheckBox.addEventListener('click', function(e){
          if(!propCheckBox.checked){
            propInfo.style.display = 'none'
          }
          else{
            propInfo.style.display = 'block';
          }
        });
      }
      /**
       * generic object passed as param to populateSasMolInfo
       * @namespace
       * @prop {string} title   title of sasmol field
       * @prop {string} info    literal text of what to display (account for big files)
       */
      var sasmolInfoObj = {
        title: '',
        info: ''
      };
      var segnameObj = Object.create(sasmolInfoObj);
      segnameObj.title = 'SEGNAME';
      //display range (first - last)
      segnameObj.info = object.getSegname()[0] + ' ... ' + object.getSegname()[object.getSegname().length - 1];

      var betaObj = Object.create(sasmolInfoObj);
      betaObj.title = 'BETA';
      //display range (first - last)
      betaObj.info = object.getBeta()[0] + ' ... ' + object.getBeta()[object.getBeta().length - 1];


      populateSasMolInfo(segnameObj);
      populateSasMolInfo(betaObj);


      //push to arrays
      widgetContainerArr[i] = widgetContainer;
      seqContainerArr[i] = sequenceContainer;
      seqDivArr[i] = sequenceDiv;
      locatorDivArr[i] = locatorDiv;
      locatorBoxArr[i] = locatorBox;

      zoomDivArr[i] = zoomDiv;
      // seqSelDivArr[i] = selectDisplay;
      seqSelRangeDivArr[i] = selectDisplayRange;



    }

    //POPULATE PDB MEMORY BOX
    //output is just an array of strings that get converted to text displayed in HTML
    var output = [];
    //FUTURE DEVELOPMENT
    //ex: chain A is hardcoded (future goal: make modular after implementing read MODEL/chain)
    output.push('&lt;li>', 'chain A','&lt;ul>');

    //uncomment below to loop through entire numAtoms (bad idea for huge pdb files)
    // for(var i = 0; i&lt;numAtomsArr[sobjIndex]; i++){
    //   //iterate through atoms and display in bullets
    //   output.push('&lt;li>', object.getAtom()[i], '&lt;/li>');
    // }

    // only print first and last
    output.push('&lt;li>', object.getAtom()[0], '&lt;/li>');
    output.push('&lt;li>', '...', '&lt;/li>');
    output.push('&lt;li>', object.getAtom()[numAtomsArr[sobjIndex] - 1], '&lt;/li>');
    //end of ul
    output.push('&lt;/ul>','&lt;/li>');
    document.getElementById('pdb_memory').innerHTML = '&lt;ul>' + output.join('') + '&lt;/ul>';

    //(Debugging purposes)
    loadBool = true;
  }

//DOCUMENT EVENT LISTENERS
//make keypress event general (only open if there exists a value to be_zoomed in on)
document.addEventListener('keydown',function(e){
  //only zoom on active elements (sequenceDiv can be focused by right-clicking)
  var activeElt = document.activeElement;
  if(e.shiftKey &amp;&amp; seqDivFlag &amp;&amp; (activeElt.className == 'sequenceDiv')){
    //switch on flag
    zoomPress = true;

    //extract id
    var reg = /(\d)/;
    var sobjIndex = reg.exec(activeElt.id)[1];
    //console.log(sobjIndex);

    zoomDivArr[sobjIndex].style.display = 'block';
    if((parseInt(locatorBoxArr[sobjIndex].innerText) &lt; seqObjArr[sobjIndex].length)){
      //grab index displayed in locatorDiv and populate zoom div
      var index = parseInt(locatorBoxArr[sobjIndex].innerText);
      populateZoomDiv(index, sobjIndex);
    }

    currentZoomedWidget = sobjIndex;
  }



});
//Keyup event doesn't apply to a specific key so use a flag to check if zoom was held before
document.addEventListener('keyup',function(e){
  if(zoomPress){
    //remove all HTML for marking zoom ranges
    for(var i = 0; i&lt; document.querySelectorAll('.zoomed-lefthook').length;i++){
      document.querySelectorAll('.zoomed-lefthook')[i].classList.remove('zoomed-lefthook');
      document.querySelectorAll('.zoomed-righthook')[i].classList.remove('zoomed-righthook');
    }

    zoomDivArr[currentZoomedWidget].style.display = 'none';
    //switch off flag
    zoomPress = false;
  }

});


/**
 * initialize sequence objects inside divs (main HTML handler)
 * @name initialize
 * @func
 * @param  {string} action    denotes action to be taken (FUTURE DEVELOPMENT) - can pass 'start', possibly 'reload' in the future for responsiveness
 * @param  {SasMol.SasMol} object    sasmol objects
 * @param  {number} sobjIndex sobj Index
 */
  function initialize(action, object, sobjIndex){
    var seqDiv = seqDivArr[sobjIndex];
    //initialize seqobjarray[sobjIndex] to empty array (fill in later)
    seqObjArr[sobjIndex] = [];
    var num = numAtomsArr[sobjIndex];

    // Logic to make divs responsive (FOR FUTURE DEVELOPMENT - would have to re-initialize everything)
    if(action=='reload'){
      $('.sequenceDiv '+ sobjIndex).find('.res').remove();
      $('.sequenceDiv '+ sobjIndex).find('.dividers').remove();

    }

    //update calculation (4 is for the pixel border - find in widgetStyle.css)
    var seqDivWidth = seqDivArr[sobjIndex].offsetWidth-4;
    //initialize span elements
    for(var i=0;i&lt;num;i++){

      var newSpan = document.createElement('span');
      newSpan.className = 'res';
      newSpan.style.width = (seqDivWidth/num) + 'px';
      newSpan.id = '_' + Math.random().toString(36).substr(2, 9);


        /**
         * MODULAR sequence object (as opposed to original method of embedding sasmol information inside DOM id's and using regex's to slice everywhere)
         * @namespace
         * @prop  {SasMol} sasAtom   corresponding sasmol object
         * @prop   {String}  dom_id  corresponding DOM id
         * @prop   {boolean} zoomed  boolean flag for detecting if elt is being zoomed on (currently UNUSED)
         * @prop   {boolean} selected boolean flag for detecting if elt is selected (currently UNUSED)
         * @prop   {number}  pdbIndex  corresponding sobjIndex
         * @prop   {String}  zoomText  text to display when elt is being zoomed in on (currently atom name)
         * @prop   {number}  seqObjArrIndex  index of seqObj inside parent seqObjArr
         */
        var seqObj = {
          sasAtom: object,
          dom_id : newSpan.id,
          zoomed : false,
          selected : false,
          pdbIndex : sobjIndex,
          zoomText : object.getName()[i] + '\n' + object.getAtom()[i],
          seqObjArrIndex: i
        };
        //add seqobj to global seqobj array
        seqObjArr[sobjIndex][i] = seqObj;
      seqDiv.appendChild(newSpan);


      //insert dividers
      var newDivider = document.createElement('div');
      newDivider.className = 'divider';
      //logic for limits on dividers
      if(num &lt;= 20 &amp;&amp; i&lt;num){
        createDivider();
      }
      else if(i%10==0 &amp;&amp; num &lt;= 200 &amp;&amp; i&lt;num){
        createDivider();
      }
      else if(i%100==0 &amp;&amp; num &lt;=2000 &amp;&amp; i&lt;num){
        createDivider();
      }
      /**
       * creates dividers
       * @name createDivider
       * @func
       */
      function createDivider(){
        newDivider.style.left = (seqDivWidth/num)*i + 'px';
        newDivider.style.fontSize = '12px';
        var textNode = document.createTextNode(i+1);
        newDivider.appendChild(textNode);
        seqDiv.appendChild(newDivider);
      }

    }
      //update elt width after new calculations
      eltWidth = document.querySelectorAll('.res')[0].getBoundingClientRect().width;

      seqDivWidthArr[sobjIndex] = seqDivWidth;
      eltWidthArr[sobjIndex] = eltWidth;
      //DEMO
      console.log(seqObjArr);

      //instantiate dragselectors - refer to DRAGSELECTJS API for what these fields mean
      //https://thibaultjanbeyer.github.io/DragSelect/
        var ds = new DragSelect({
        selectables: document.getElementsByClassName('res'),
        area: seqDiv,
        multiSelectKeys: ['ctrlKey'],
        onDragMove: function(e){
          var selection = dsArr[sobjIndex].getSelection();
          //only do computations if there selection array isn't empty
          if(selection.length>0){
            var lastEltID = selection[selection.length-1].id;
            //console.log("lastELt: "+lastElt);
            var obj = getObjectByValue(seqObjArr[sobjIndex], lastEltID);

            updateCurrSelection('endIndex', obj, sobjIndex);
          }
        },
        onDragStart: function(e){
          var selection = dsArr[sobjIndex].getSelection();
          //only do computations if there selection array isn't empty
          if(selection.length>0){
            var lastEltID = selection[selection.length-1].id;
            //console.log("lastELt: "+lastElt);
            var obj = getObjectByValue(seqObjArr[sobjIndex], lastEltID);

            updateCurrSelection('startIndex', obj, sobjIndex);
          }


        },
        callback: function(){
          var selection = dsArr[sobjIndex].getSelection();
          if(selection.length==0){
            updateCurrSelection('startIndex', {atomNum: ""}, sobjIndex);
            updateCurrSelection('endIndex',{atomNum: ""}, sobjIndex);
          }
          calibrateDisp(sobjIndex);
          updateSelDisplay(sobjIndex);

        },
        selector: document.getElementsByClassName('customSelector')[sobjIndex],
        onElementSelect: function(item){
          mirror(item,'select', sobjIndex);
        },
        onElementUnselect: function(item){
          mirror(item,"unselect", sobjIndex);
        }

      });

      //instantiate new dragselect within zoombox
      var zoomds = new DragSelect({
        multiSelectKeys: ['ctrlKey'],
        area:zoomDivArr[sobjIndex],
        onDragMove: function(e){

          var selection = zoomdsArr[sobjIndex].getSelection();

          //only do computations if there selection array isn't empty
          if(selection.length>0){
            var lastEltID = selection[selection.length-1].id;
            var obj = getObjectByValue(seqObjArr[sobjIndex], lastEltID);

            updateCurrSelection('endIndex', obj, sobjIndex);
          }
        },
        onDragStart: function(e){
          var selection = zoomdsArr[sobjIndex].getSelection();
          //only do computations if there selection array isn't empty
          if(selection.length>0){
            var lastEltID = selection[selection.length-1].id;
            //console.log("lastELt: "+lastElt);
            var obj = getObjectByValue(seqObjArr[sobjIndex], lastEltID);

            updateCurrSelection('startIndex', obj, sobjIndex);
          }


        },
        //ensure that select/unselect actions are mirrored in both primary seq div and zoom div
        onElementSelect: function(item){
          mirror(item,'select', sobjIndex);
        },
        onElementUnselect: function(item){
          mirror(item,"unselect", sobjIndex);
        },
        callback: function(){
          var selection = dsArr[sobjIndex].getSelection();
          //DEMO
          //console.log(selection);

          if(selection.length==0){
            updateCurrSelection('startIndex',null, sobjIndex);
            updateCurrSelection('endIndex',null, sobjIndex);
          }
          calibrateDisp(sobjIndex);
          updateSelDisplay(sobjIndex);
        }
      });
      //add to arrays
      dsArr[sobjIndex] = ds;
      zoomdsArr[sobjIndex] = zoomds;

      //css hack (unnecessary? )
      widgetContainerArr[sobjIndex].style.position = 'absolute';
  }



/**************************************************************************
_  _  ___  __    ___  ___  ___     ___  _  _  _  _  __  ____  __  __  _  _  ___
( )( )(  _)(  )  (  ,\(  _)(  ,)   (  _)( )( )( \( )/ _)(_  _)(  )/  \( \( )/ __)
 )__(  ) _) )(__  ) _/ ) _) )  \    ) _) )()(  )  (( (_   )(   )(( () ))  ( \__ \
(_)(_)(___)(____)(_)  (___)(_)\_)  (_)   \__/ (_)\_)\__) (__) (__)\__/(_)\_)(___/
  *************************************************************************/

/**
 * helper function for mirroring selection/unselection between primary sequence div and zoom div
 * @name mirror
 * @func
 * @param  {HTML_NODE} item        HTML node to be mirrored (template)
 * @param  {String} type           type of action - select or unselect
 * @param  {Number} sobjIndex      sobj Index
 */
function mirror(item,type, sobjIndex){
  var zoomSel = zoomdsArr[sobjIndex].getSelection();
  var mainSel = dsArr[sobjIndex].getSelection();

  //SUBJECT TO CHANGE (depends on ID)
  var regex = /_[^_]*/;
  equivID = regex.exec(item.id)[0];
  //DEMO
  //console.log(equivID);
  if(type == "unselect"){
    dsArr[sobjIndex].removeSelection(document.getElementById(equivID));
    if(document.getElementsByClassName('zoomDiv')[sobjIndex].childNodes.length > 1){
      zoomdsArr[sobjIndex].removeSelection(document.getElementById(equivID+'_zoomed'));
    }
  }
  else if(type =="select"){
    dsArr[sobjIndex].addSelection(document.getElementById(equivID));
    if(document.getElementsByClassName('zoomDiv')[sobjIndex].childNodes.length > 1){
      zoomdsArr[sobjIndex].addSelection(document.getElementById(equivID+'_zoomed'));
    }
  }
}

/**
 * Purpose: Adjust innerText of Sequence Feedback box to show current Selection
 * @name updateCurrSelection
 * @func
 * @param  {String} spanClass name of span class ('startIndex' or 'endIndex')
 * @param  {Object} object    object defined in initialize() function
 * @param  {Number} sobjIndex sobj Index
 */
function updateCurrSelection(spanClass, object, sobjIndex){
  var str = "";
  if(object != null){
    str = object.sasAtom.getAtom()[object.seqObjArrIndex].toString();
  }
  document.getElementsByClassName(spanClass)[sobjIndex].innerText = str;
}

/**
 * PURPOSE: Adjust HTML of the Selection range Div in the feedback Box (displays subarrays of selections)
 * @name updateSelDisplay
 * @func
 * @param  {Number} sobjIndex sobj Index
 */
function updateSelDisplay(sobjIndex){
  //add display for SELECTION (split into contiguous arrays)
  var len = arrDisp.length;
  //clear children first
  while (seqSelRangeDivArr[sobjIndex].firstChild) {
    seqSelRangeDivArr[sobjIndex].removeChild(seqSelRangeDivArr[sobjIndex].firstChild);
  }

  if(len>0){

    for(var i=0;i&lt;len;i++){
      //initialize 'from' text
      var selspan = document.createElement('span');
      var subArray = arrDisp[i];
      var text = (subArray[0]).toString();

      //if subArray has more than one element, initialize colon part and 'to' part
      if(subArray.length>1){

        //additional part (intermediate and end)
        var mid = ' - ';
        var toText = (subArray[subArray.length-1]).toString();
        text+=mid;
        text+=toText;

      }
      var textNode = document.createTextNode(text);
      selspan.appendChild(textNode);
      selspan.classList.add('subArray');
      seqSelRangeDivArr[sobjIndex].appendChild(selspan);

    }
  }
}
/**
 * PURPOSE: helper method for clearing selection (making selection array zero, removing DOM children elements)
 * @name clearAllSelection
 * @func
 * @param  {Number} sobjIndex sobj Index
 */
function clearAllSelection(sobjIndex){
  dsArr[sobjIndex].clearSelection();
  $('.ds-selected').remove();
  arrDisp.length=0;
  updateSelDisplay(sobjIndex);
  updateCurrSelection('startIndex',null,sobjIndex);
  updateCurrSelection('endIndex',null,sobjIndex);

}
/**
 * PURPOSE: split selection array into consecutive subArrays; called when selection is made
 * @name calibrateDisp
 * @func
 * @param  {Number} sobjIndex sobj Index
 */
function calibrateDisp(sobjIndex){
  //console.log(sobjIndex);
  objArrKeyIndex = -1;
  //reset array
  arrDisp=[];


  var selection = dsArr[sobjIndex].getSelection();
  var len = selection.length;
  var currKey;
  var prevKey;
  var arrSorted = [];
  var subArray = [];
  var arrDispIndex = 0;

  //1. sort Array
  for(var i=0; i&lt;len;i++){
    currKey = getObjectByValue(seqObjArr[sobjIndex], dsArr[sobjIndex].getSelection()[i].id).seqObjArrIndex;
    //keys are zero-indexed so add 1 to make compatible with atom numbering
    arrSorted.push(currKey + 1);
  }
  arrSorted.sort(function (a, b) {  return a - b;  });
  //2. update array
  for(var i=0; i&lt;len;i++){
    //for the first element only, initialize subArray
    if(i==0){
      currKey = arrSorted[0];
      prevKey = currKey;
      subArray.push(currKey);
      arrDisp.push(subArray);
    }
    //for all other elements, compute logic for currKey and prevKey (inapplicable to first elt)
    else{
      currKey = arrSorted[i];
      prevKey = arrSorted[i-1];
      //check if contiguous
      if(prevKey == (currKey - 1)){
        arrDisp[arrDispIndex].push(currKey);
      }
      else{
        //if not contiguous, create new subArray
        subArray = [];
        subArray.push(currKey);
        arrDisp.push(subArray);
        arrDispIndex++;
      }
    }
  }
  //DEMO
  // console.log(arrDisp);
}
/**
 * Helper function for retrieving a key by its value
 * @name getKeyByValue
 * @func
 * @param  {Object} arr   There is no official JavaScript type for an Array so it is technically an Object
 * @param  {String|Number|Boolean} value value to search with
 * @return {String|Number|Boolean}       matched key to value
 */
function getKeyByValue(arr, value) {
  for(var i=0, iLen = arr.length; i&lt;iLen;i++){
    for (key in arr[i]){
      if(arr[i][key] == value){return key;}
    }

  }
}
/**
 * Helper function for retrieving an object by its value (key:value), see structure of seqObj defined in Initialize() to understand why this may be useful
 * @name getObjectByValue
 * @func
 * @param  {Object} arr   There is no official JavaScript type for an Array so it is technically an Object
 * @param  {String|Number|Boolean} value value to search with
 * @return {Object}       matched object
 */
function getObjectByValue(arr, value) {
  for(var i=0, iLen = arr.length; i&lt;iLen;i++){
    for (key in arr[i]){
      if(arr[i][key] == value){return arr[i];}
    }

  }
}

/**
 * Function for toggling on the displayLocator box
 * @name displayLocator
 * @func
 * @param  {String} loc       string to fill locator box with
 * @param  {Number} sobjIndex sobj Index
 */
  function displayLocator(loc, sobjIndex){
    locatorDivArr[sobjIndex].style.display='block';
    locatorBoxArr[sobjIndex].innerText=loc;
  }
/**
 * Function for geometrically computing (sequence) index based on position of mouse
 * @name getIndexByWidth
 * @func
 * @param  {Number} x         x coordinate of mouse
 * @param  {Number} sobjIndex sobj Index
 * @return {Number}           "equivalent" sequence index
 */
  function getIndexByWidth(x, sobjIndex){
    return Math.ceil(x/eltWidthArr[sobjIndex]);
  }


  /**
   * Fills zoomDiv with HTML elements; takes in value in locatorBox to display a range
   * @name populateZoomDiv
   * @func
   * @param  {Number} index     sequence index
   * @param  {Number} sobjIndex sobj Index
   */
  function populateZoomDiv(index, sobjIndex){
    //clear children except selector box
    while(zoomDivArr[sobjIndex].children.length>1){
      zoomDivArr[sobjIndex].removeChild(zoomDivArr[sobjIndex].lastChild);
    }
    var zoomRangeLeft;
    var zoomRangeWidth;

    // MAKE MODULAR (values in parentheses can be variadic in the future)
    var lorange = index - (5) - 1;
    if(index &lt;= (5)){
      lorange = 0;
    }
    var hirange = index + (5);
    if(hirange > seqObjArr[sobjIndex].length){
      hirange = seqObjArr[sobjIndex].length;
    }
    for(var i = lorange; i&lt;hirange;i++){
      var obj = getObjectByValue(seqObjArr[sobjIndex],i);
      var atomName = obj.sasAtom.getName()[obj.seqObjArrIndex];
      var atomNum = obj.sasAtom.getAtom()[obj.seqObjArrIndex];


      var resZoom = document.createElement('span');
      resZoom.className = 'res';
      resZoom.innerText = obj.zoomText;
      var id = obj.dom_id;
      resZoom.id = id+'_zoomed';
      resZoom.style.height = '30px';
      resZoom.style.width = '30px';
      resZoom.style.fontSize = '14px';
      resZoom.style.margin = '5px';
      resZoom.style.border = '1px solid black';
      zoomDivArr[sobjIndex].appendChild(resZoom);
      zoomdsArr[sobjIndex].addSelectables(resZoom);

      //mirror in zoomDiv because these new spans are called after selection in primary seq div
      var mirrorItem = document.getElementById(id);
      //check if selected
      if(mirrorItem.className.includes('ds-selected')){
        mirror(mirrorItem,"select", sobjIndex);
      }
      //HTML stuff for marking edges of a zoom range
      if(i==lorange){
        mirrorItem.classList.add('zoomed-lefthook');
        zoomRangeLeft = mirrorItem.offsetLeft;
      }
      else if(i==hirange-1){
        mirrorItem.classList.add('zoomed-righthook');
      }
      //FUTURE DEVELOPMENT - add some CSS for marking intermediate zoomed - elts?
      // else{
      //   mirrorItem.classList.add('zoomed-middle');
      // }

    }
  }


/**
 * Helper function to get an element's exact position (if nested in container divs)
 * CREDIT: https://www.kirupa.com/html5/get_element_position_using_javascript.htm
 * @name getPosition
 * @func
 * @param  {HTML_NODE} el HTML node of interest
 * @return {Object}    object with x and y coordinates
 */
function getPosition(el) {
  var xPos = 0;
  var yPos = 0;

  while (el) {
    if (el.tagName == "BODY") {
      // deal with browser quirks with body/window/document and page scroll
      var xScroll = el.scrollLeft || document.documentElement.scrollLeft;
      var yScroll = el.scrollTop || document.documentElement.scrollTop;

      xPos += (el.offsetLeft - xScroll + el.clientLeft);
      yPos += (el.offsetTop - yScroll + el.clientTop);
    } else {
      // for all other non-BODY elements
      xPos += (el.offsetLeft - el.scrollLeft + el.clientLeft);
      yPos += (el.offsetTop - el.scrollTop + el.clientTop);
    }

    el = el.offsetParent;
  }
  return {
    x: xPos,
    y: yPos
  };
}



} );//end of jQuery.ready()
</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
	
		on August 1st 2018, 5:56:00 pm
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
